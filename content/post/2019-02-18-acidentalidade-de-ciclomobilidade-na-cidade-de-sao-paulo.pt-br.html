---
title: Acidentalidade de ciclomobilidade na cidade de São Paulo
author: Bruno Pinheiro
date: '2019-02-18'
slug: acidentalidade-de-ciclomobilidade-na-cidade-de-sao-paulo.pt-br
categories:
- Análises
tags:
  - ciclomobilidade
  - mobilidade urbana
  - planejamento urbano
  - acidentalidade
  - ideciclo
type: ''
subtitle: 'Análise do IDECiclo 2018 da Auditoria Cidadã'
image: ''
code_folding: hide
---



<div id="os-dados" class="section level2">
<h2>Os dados</h2>
<p>Os dados de acidentalidade estão divididos em três conjuntos, contendo informações a respeito dos acidentes, das vítimas e dos veículos.</p>
<p>Esta análise será realizada com bases de dados previamente preparadas, em procedimento que agregou os dados referentes aos anos de 2011 à 2017, por conjunto.</p>
<pre class="r"><code>library(tidyverse)
library(lubridate)
library(gridExtra)

acidentes &lt;- readRDS(&quot;data-raw/acidentes-mortos-feridos-2011-2017.rds&quot;)
vitimas &lt;- readRDS(&quot;data-raw/vitimas-mortos-feridos-2011-2017.rds&quot;)
veiculos &lt;- readRDS(&quot;data-raw/veiculos-mortos-feridos-2011-2017.rds&quot;)</code></pre>
<p>A base de acidentes contem 151159 observações, que correspondem a ocorrências registradas pela CET entre 2011 e 2017. Há ainda 57 colunas, com variáveis descrevendo atributos de cada um dos acidentes, com variações ao longo dos anos.</p>
<pre class="r"><code>glimpse(acidentes)</code></pre>
<pre><code>## Observations: 151,159
## Variables: 57
## $ id_acidente    &lt;chr&gt; &quot;D011100001&quot;, &quot;D011100002&quot;, &quot;D011100003&quot;, &quot;D01110…
## $ cadloga        &lt;chr&gt; &quot;33306&quot;, &quot;11818&quot;, &quot;33667&quot;, &quot;33667&quot;, &quot;10376&quot;, &quot;167…
## $ cadlogb        &lt;chr&gt; NA, NA, NA, NA, NA, &quot;03189&quot;, NA, NA, NA, NA, NA, …
## $ alt_num        &lt;chr&gt; &quot;100&quot;, &quot;749&quot;, &quot;0&quot;, &quot;0&quot;, &quot;1&quot;, &quot;0&quot;, &quot;0&quot;, &quot;397&quot;, &quot;0&quot;…
## $ referencia     &lt;chr&gt; NA, NA, &quot;NC&quot;, &quot;NC&quot;, NA, NA, &quot;EN - VD GLORIA&quot;, NA,…
## $ data_raw       &lt;chr&gt; &quot;02/01/2011&quot;, &quot;03/01/2011&quot;, &quot;03/01/2011&quot;, &quot;03/01/…
## $ hora           &lt;chr&gt; &quot;16:12&quot;, &quot;08:40&quot;, &quot;11:14&quot;, &quot;14:32&quot;, &quot;08:42&quot;, &quot;14:…
## $ cod_acid       &lt;chr&gt; &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;4&quot;, &quot;2&quot;, &quot;2&quot;, &quot;4&quot;, &quot;4&quot;,…
## $ tipo_acidente  &lt;chr&gt; &quot;SI&quot;, &quot;CO&quot;, &quot;SI&quot;, &quot;CT&quot;, &quot;CT&quot;, &quot;AT&quot;, &quot;CT&quot;, &quot;CT&quot;, &quot;…
## $ talao          &lt;dbl&gt; 20, 33, 41, 45, 144, 161, 212, 328, 333, 357, 366…
## $ automovel      &lt;dbl&gt; 1, 1, 1, 2, 1, 0, 1, 2, 0, 1, 1, 1, 2, 1, 0, 0, 1…
## $ moto           &lt;dbl&gt; 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ onibus         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0…
## $ caminhao       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ bicicleta      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ moto_taxi      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ onibus_fretado &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ onibus_urbano  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0…
## $ microonibus    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ van            &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ vuc            &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ caminhonete    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ carreta        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ jipe           &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ carroca        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ outros         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ sem_informacao &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ feridos        &lt;dbl&gt; 2, 1, 1, 1, 2, 1, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ mortos         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ dp             &lt;chr&gt; &quot;01&quot;, &quot;01&quot;, &quot;01&quot;, &quot;01&quot;, &quot;01&quot;, &quot;01&quot;, &quot;01&quot;, &quot;01&quot;, &quot;…
## $ det            &lt;chr&gt; &quot;HG&quot;, &quot;CT&quot;, &quot;CT&quot;, &quot;CT&quot;, &quot;CT&quot;, &quot;CT&quot;, &quot;CT&quot;, NA, &quot;CT…
## $ distrito       &lt;chr&gt; &quot;02&quot;, &quot;49&quot;, &quot;02&quot;, &quot;02&quot;, &quot;80&quot;, &quot;80&quot;, &quot;02&quot;, NA, &quot;80…
## $ mapinfo_id     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ fonte          &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ viatura        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ veiculos       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ vitimas        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ dec            &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ folha          &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ princ_a        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ princ_b        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ tipo_plac1     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ tipo_plac2     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ tipo_plac3     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ logradouro_a   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ logradouro_b   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ dia__semana    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ dia_semana     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ mes_acidente   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ periodo_dia    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ distrito_atz   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ pref_reg       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ tipos_acid     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ lat            &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ long           &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ dataok         &lt;chr&gt; &quot;2011-01-02&quot;, &quot;2011-01-03&quot;, &quot;2011-01-03&quot;, &quot;2011-0…
## $ ano            &lt;dbl&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2…</code></pre>
<p>A base de vitimas contem, por sua vez, 185260 observações, cada uma com dados de vítimas dos acidentes registrados pela CET organizados em 17 variáveis.</p>
<pre class="r"><code>glimpse(vitimas)</code></pre>
<pre><code>## Observations: 185,260
## Variables: 17
## $ id_acidente   &lt;chr&gt; &quot;D011100001&quot;, &quot;D011100001&quot;, &quot;D011100002&quot;, &quot;D011100…
## $ id_vitima     &lt;chr&gt; &quot;001&quot;, &quot;002&quot;, &quot;001&quot;, &quot;001&quot;, &quot;001&quot;, &quot;001&quot;, &quot;002&quot;, &quot;…
## $ id_veiculo    &lt;chr&gt; &quot;01&quot;, &quot;01&quot;, &quot;01&quot;, &quot;01&quot;, &quot;01&quot;, &quot;01&quot;, &quot;01&quot;, &quot;01&quot;, &quot;0…
## $ sexo          &lt;chr&gt; &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;F&quot;, &quot;M&quot;, &quot;M&quot;, &quot;F&quot;, …
## $ idade         &lt;dbl&gt; 21, 22, 27, 30, 35, 28, 27, 58, 24, 23, NA, 23, 32…
## $ tipo_vitima   &lt;chr&gt; &quot;CD&quot;, &quot;PS&quot;, &quot;CD&quot;, &quot;CD&quot;, &quot;CD&quot;, &quot;CD&quot;, &quot;PS&quot;, &quot;PD&quot;, &quot;C…
## $ classificacao &lt;chr&gt; &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, …
## $ tipo_veiculo  &lt;chr&gt; &quot;AU&quot;, &quot;AU&quot;, &quot;MO&quot;, &quot;MO&quot;, &quot;AU&quot;, &quot;MO&quot;, &quot;MO&quot;, &quot;MO&quot;, &quot;A…
## $ estado_alc    &lt;chr&gt; &quot;BR&quot;, &quot;BR&quot;, &quot;BR&quot;, &quot;BR&quot;, &quot;BR&quot;, &quot;BR&quot;, &quot;BR&quot;, &quot;BR&quot;, &quot;B…
## $ escolaridade  &lt;chr&gt; &quot;7&quot;, &quot;5&quot;, &quot;7&quot;, &quot;5&quot;, &quot;5&quot;, &quot;7&quot;, &quot;5&quot;, &quot;8&quot;, &quot;8&quot;, &quot;8&quot;, …
## $ data_raw      &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ mapinfo_id    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ data_obito    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ mes_acid      &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ tipo_usuario  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ dataok        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ ano           &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</code></pre>
<p>Já no conjunto de dados sobre os veículos existem 254989 observações, com os veículos envolvidos nos acidentes constantes na base de acidentes. Há 10 variáveis com atributos dos meios de transporte acidentados.</p>
<pre class="r"><code>glimpse(veiculos)</code></pre>
<pre><code>## Observations: 254,989
## Variables: 10
## $ id_acidente           &lt;chr&gt; &quot;D011100001&quot;, &quot;D011100002&quot;, &quot;D011100002&quot;, …
## $ id_veiculo            &lt;chr&gt; &quot;01&quot;, &quot;01&quot;, &quot;02&quot;, &quot;01&quot;, &quot;02&quot;, &quot;01&quot;, &quot;02&quot;, …
## $ tipo_veiculo          &lt;chr&gt; &quot;AU&quot;, &quot;MO&quot;, &quot;AU&quot;, &quot;MO&quot;, &quot;AU&quot;, &quot;AU&quot;, &quot;AU&quot;, …
## $ sexo_condutor         &lt;chr&gt; &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;X&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M…
## $ idade_condutor        &lt;dbl&gt; 21, 27, 61, 30, NA, 35, 48, 28, 71, 21, 24…
## $ categoria_habilitacao &lt;chr&gt; &quot;SI&quot;, &quot;SI&quot;, &quot;SI&quot;, &quot;SI&quot;, &quot;SI&quot;, &quot;SI&quot;, &quot;SI&quot;, …
## $ usa_cinto_seguranca   &lt;chr&gt; &quot;X&quot;, &quot;X&quot;, &quot;X&quot;, &quot;X&quot;, &quot;X&quot;, &quot;X&quot;, &quot;X&quot;, &quot;X&quot;, &quot;X…
## $ estado_alc            &lt;chr&gt; &quot;BR&quot;, &quot;BR&quot;, &quot;BR&quot;, &quot;BR&quot;, &quot;BR&quot;, &quot;BR&quot;, &quot;BR&quot;, …
## $ escolaridade          &lt;chr&gt; &quot;7&quot;, &quot;7&quot;, &quot;6&quot;, &quot;5&quot;, &quot;8&quot;, &quot;5&quot;, &quot;5&quot;, &quot;7&quot;, &quot;8…
## $ mapinfo_id            &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</code></pre>
<div id="valores-ausentes" class="section level3">
<h3>Valores ausentes</h3>
<p>Como há variáveis que existem em alguns anos, mas não em outros, algumas variáveis não descrevem aspectos dos acidentes, das vítimas e dos veículos para todos os anos. O gráficos abaixo mostram a análise de valores ausentes (<code>NA</code>) nos três conjuntos de dados e explicitam este problema.</p>
<pre class="r"><code>theme_set(theme_minimal())

acidentes %&gt;% 
  gather(key, value, -ano) %&gt;% 
  group_by(ano, key) %&gt;% 
  count(na = is.na(value)) %&gt;% 
  mutate(na = if_else(na == TRUE, &quot;Sim&quot;, &quot;Não&quot;)) %&gt;% 
  ggplot(aes(x = key, y = n, fill = na)) +
  geom_bar(stat = &quot;identity&quot;) +
  scale_fill_manual(values = c(&quot;lightcoral&quot;, &quot;lightgrey&quot;), &quot;Valor é NA?&quot;) +
  facet_wrap(~ano, ncol = 7, scales = &quot;free_x&quot;) +
  labs(title = &quot;Valores ausentes na base de acidentes&quot;,
       x = NULL, y = NULL) +
  theme(axis.text.x = element_blank(),
        legend.position = &quot;top&quot;) +
  coord_flip()</code></pre>
<p><img src="/post/2019-02-18-acidentalidade-de-ciclomobilidade-na-cidade-de-sao-paulo.pt-br_files/figure-html/unnamed-chunk-5-1.png" width="864" style="display: block; margin: auto;" /></p>
<pre class="r"><code>vitimas %&gt;% 
  gather(key, value, -ano) %&gt;% 
  group_by(ano, key) %&gt;% 
  count(na = is.na(value)) %&gt;% 
  mutate(na = if_else(na == TRUE, &quot;Sim&quot;, &quot;Não&quot;)) %&gt;% 
  ggplot(aes(x = key, y = n, fill = na)) +
  geom_bar(stat = &quot;identity&quot;) +
  scale_fill_manual(values = c(&quot;lightcoral&quot;, &quot;lightgrey&quot;), &quot;Valor é NA?&quot;) +
  facet_wrap(~ano, ncol = 7, scales = &quot;free_x&quot;) +
  labs(title = &quot;Valores ausentes na base de vítimas&quot;,
       x = NULL, y = NULL) +
  theme(axis.text.x = element_blank(),
        legend.position = &quot;top&quot;) +
  coord_flip()</code></pre>
<p><img src="/post/2019-02-18-acidentalidade-de-ciclomobilidade-na-cidade-de-sao-paulo.pt-br_files/figure-html/unnamed-chunk-6-1.png" width="864" style="display: block; margin: auto;" /></p>
<pre class="r"><code>veiculos %&gt;% 
  gather(key, value) %&gt;% 
  group_by(key) %&gt;% 
  count(na = is.na(value)) %&gt;% 
  mutate(na = if_else(na == TRUE, &quot;Sim&quot;, &quot;Não&quot;)) %&gt;% 
  ggplot(aes(x = key, y = n, fill = na)) +
  geom_bar(stat = &quot;identity&quot;) +
  scale_fill_manual(values = c(&quot;lightcoral&quot;, &quot;lightgrey&quot;), &quot;Valor é NA?&quot;) +
  labs(title = &quot;Valores ausentes na base de veículos&quot;,
       x = NULL, y = NULL) +
  theme(axis.text.x = element_blank(),
        legend.position = &quot;top&quot;) +
  coord_flip()</code></pre>
<p><img src="/post/2019-02-18-acidentalidade-de-ciclomobilidade-na-cidade-de-sao-paulo.pt-br_files/figure-html/unnamed-chunk-7-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="analise-dos-acidentes" class="section level2">
<h2>Análise dos acidentes</h2>
<div id="o-numero-de-acidentes-vem-caindo-com-os-anos" class="section level3">
<h3>O número de acidentes vem caindo com os anos</h3>
<p>Em 7 anos (2011 a 2017) a CET registrou 151159 acidentes na cidade de São Paulo.</p>
<pre class="r"><code>total_acidentes &lt;- acidentes %&gt;%
  group_by(ano = as.factor(ano)) %&gt;% 
  summarise(geral = n(),
            bicicleta = sum(bicicleta, na.rm = TRUE)) %&gt;% 
  mutate(Percentual = round(bicicleta / geral, 3))

p1 &lt;- ggplot(total_acidentes, aes(x = ano, y = geral)) +
  geom_line(group = 1) +
  geom_point(size = 3) +
  geom_hline(aes(yintercept = mean(total_acidentes$geral)),
             linetype = 5, color = &quot;darkgrey&quot;, lwd = 1.5) +
  scale_y_continuous(limits = c(0, 30000), breaks = seq(0, 30000, 5000)) +
  labs(title = &quot;Evolução temporal do total anual de acidentes&quot;,
       subtitle = &quot;todos os acidentes&quot;,
       x = NULL, y = NULL) +
  annotate(&quot;text&quot;, x = 2, y = 17000, color = &quot;darkgrey&quot;,
           label = paste(&quot;Média de&quot;, round(mean(total_acidentes$geral)),
                         &quot;\nacidentes por ano&quot;),
           fontface = &quot;bold&quot;)

p2 &lt;- ggplot(total_acidentes, aes(x = as.factor(ano), y = bicicleta, group = 1)) +
  geom_line(color = &quot;lightcoral&quot;) +
  geom_point(size = 3, color = &quot;lightcoral&quot;) +
  geom_hline(aes(yintercept = mean(total_acidentes$bicicleta)),
             linetype = 5, color = &quot;darkgrey&quot;, lwd = 1.5) +
  scale_y_continuous(limits = c(0, 1000), breaks = seq(0, 1000, 100)) +
  labs(title = NULL, subtitle = &quot;somente bicicleta&quot;,
       x = NULL, y = NULL) +
  annotate(&quot;text&quot;, x = 2, y = 460, color = &quot;darkgrey&quot;,
           label = paste(&quot;Média de&quot;, round(mean(total_acidentes$bicicleta)),
                         &quot;\nacidentes por ano&quot;),
           fontface = &quot;bold&quot;)

grid.arrange(p1, p2, ncol = 1)</code></pre>
<p><img src="/post/2019-02-18-acidentalidade-de-ciclomobilidade-na-cidade-de-sao-paulo.pt-br_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="e-o-numero-de-mortos-tambem-reduziu" class="section level3">
<h3>E o número de mortos também reduziu…</h3>
<pre class="r"><code>mortalidade &lt;- acidentes %&gt;% 
  group_by(ano = as.factor(ano)) %&gt;% 
  summarise(geral = sum(mortos, na.rm = TRUE)) %&gt;% 
  left_join(
    acidentes %&gt;% 
      filter(bicicleta == 1) %&gt;% 
      group_by(ano = as.factor(ano)) %&gt;% 
      summarise(bicicleta = sum(mortos, na.rm = TRUE)),
    by = &quot;ano&quot;
    ) %&gt;% 
  mutate(taxag = geral / total_acidentes$geral * 100,
         taxab = bicicleta / total_acidentes$bicicleta * 100)

# mortos no geral
p1 &lt;- ggplot(mortalidade, aes(x = ano, y = geral)) +
  geom_point(color = &quot;black&quot;, size = 3) +
  geom_line(color = &quot;black&quot;, group = 1) +
  geom_hline(aes(yintercept = mean(mortalidade$geral)),
             linetype = 5, color = &quot;darkgrey&quot;, lwd = 1.5) +
  scale_y_continuous(breaks = seq(0, 1400, 200)) +
  labs(title = &quot;Número de mortos em acidentes por ano&quot;,
       subtitle = &quot;todos os acidentes&quot;,
       x = NULL, y = NULL) +
  annotate(&quot;text&quot;, x = 2, y = 700, color = &quot;darkgrey&quot;, fontface = &quot;bold&quot;,
           label = paste(&quot;Em média&quot;, round(mean(mortalidade$geral)),
                         &quot;\nvítimas fatais por ano&quot;))

# mortes com bicicleta
p2 &lt;- ggplot(mortalidade, aes(x = ano, y = bicicleta)) +
  geom_point(color = &quot;lightcoral&quot;, size = 3) +
  geom_line(color = &quot;lightcoral&quot;, group = 1) +
  geom_hline(aes(yintercept = mean(mortalidade$bicicleta, na.rm = TRUE)),
             linetype = 5, color = &quot;darkgrey&quot;, lwd = 1.5) +
  scale_y_continuous(limits = c(0, 55), breaks = seq(0, 55, 10)) +
  labs(title = NULL, subtitle = &quot;somente bicicleta&quot;,
       x = NULL, y = NULL) +
  annotate(&quot;text&quot;, x = 2, y = 35, color = &quot;darkgrey&quot;, fontface = &quot;bold&quot;,
           label = paste(&quot;Em média&quot;, round(mean(mortalidade$bicicleta, na.rm = TRUE)),
                         &quot;\nvítimas fatais por ano&quot;))

grid.arrange(p1, p2, ncol = 1)</code></pre>
<p><img src="/post/2019-02-18-acidentalidade-de-ciclomobilidade-na-cidade-de-sao-paulo.pt-br_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="mas-a-taxa-de-mortalidade-cresceu" class="section level3">
<h3>… mas a taxa de mortalidade cresceu</h3>
<p>Aproximadamente 9 pessoas morrem a cada 100 acidentes com bicicleta</p>
<pre class="r"><code>mortalidade %&gt;% 
  select(taxag, taxab, ano) %&gt;% 
  gather(key, value, -ano) %&gt;% 
  mutate(key = if_else(key == &quot;taxag&quot;, &quot;geral&quot;, &quot;bicicleta&quot;)) %&gt;% 
  ggplot(aes(x = ano, y = value, colour = key)) +
  geom_point(size = 3) +
  geom_line(aes(group = key)) +
  scale_colour_manual(values = c(&quot;lightcoral&quot;, &quot;black&quot;)) +
  scale_y_continuous(breaks = seq(0, 9, 1)) +
  labs(title = &quot;Evolução anual da taxa de fatalidade&quot;,
       subtitle = &quot;n mortos para cada 100 acidentes&quot;,
       x = NULL, y = NULL)</code></pre>
<p><img src="/post/2019-02-18-acidentalidade-de-ciclomobilidade-na-cidade-de-sao-paulo.pt-br_files/figure-html/unnamed-chunk-10-1.png" width="864" style="display: block; margin: auto;" /></p>
</div>
<div id="bicicleta-e-sempre-a-quinta-no-ranking-de-veiculos" class="section level3">
<h3>Bicicleta é sempre a quinta no ranking de veículos</h3>
<pre class="r"><code>veiculos_acidentes &lt;- acidentes %&gt;% 
  select(ano, automovel:outros) %&gt;% 
  gather(veiculo, valor, -ano) %&gt;% 
  group_by(ano, veiculo) %&gt;% 
  summarise(total = sum(valor, na.rm = TRUE)) %&gt;% 
  mutate(veiculo = if_else(str_detect(veiculo, &quot;camin&quot;), &quot;caminhoes&quot;, veiculo),
         veiculo = gsub(&quot;vuc&quot;, &quot;caminhoes&quot;, veiculo),
         veiculo = gsub(&quot;carreta&quot;, &quot;outros&quot;, veiculo),
         veiculo = if_else(str_detect(veiculo, &quot;onibus&quot;), &quot;onibus&quot;, veiculo),
         veiculo = if_else(str_detect(veiculo, &quot;moto&quot;), &quot;moto&quot;, veiculo),
         veiculo = gsub(&quot;jipe&quot;, &quot;automovel&quot;, veiculo),
         veiculo = gsub(&quot;carroca&quot;, &quot;outros&quot;, veiculo),
         veiculo = gsub(&quot;carroca&quot;, &quot;outros&quot;, veiculo)) %&gt;% 
  group_by(ano, veiculo) %&gt;% 
  summarise(total = sum(total, na.rm = TRUE)) %&gt;% 
  mutate(bike = if_else(veiculo == &quot;bicicleta&quot;, &quot;bicicleta&quot;, &quot;outros&quot;))

plot_ano &lt;- function(data){
  veiculos_acidentes %&gt;% filter(ano == data) %&gt;%  
    ggplot(aes(x = reorder(veiculo, -total), y = total, fill = bike)) +
    geom_bar(stat = &quot;identity&quot;) +
    scale_fill_manual(values = c(&quot;lightcoral&quot;, &quot;darkgrey&quot;), guide = FALSE) +
    scale_y_continuous(limits = c(0, 20000)) +
    labs(subtitle = data, x = NULL, y = NULL) +
    theme(axis.text.x = element_text(angle = 90))
}

p &lt;- lapply(c(2011:2014, 2016:2017), function(x) plot_ano(x))

do.call(gridExtra::grid.arrange, c(p, ncol = 6))</code></pre>
<p><img src="/post/2019-02-18-acidentalidade-de-ciclomobilidade-na-cidade-de-sao-paulo.pt-br_files/figure-html/unnamed-chunk-11-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>Na base de 2015 não há variáveis indicando o envolvimento de tipos de veículos nos acidentes, por isto o gráfico deste ano não mostra nenhum dado..</p>
<pre class="r"><code>knitr::kable(
  total_acidentes %&gt;% 
  mutate(Percentual = scales::percent(round(bicicleta / geral, 3))) %&gt;% 
  select(ano, Percentual) %&gt;% 
  spread(ano, Percentual),
  caption = &quot;Peso percentual dos acidentes com bicicleta em relação ao total&quot;
)</code></pre>
<table>
<caption><span id="tab:unnamed-chunk-12">Table 1: </span>Peso percentual dos acidentes com bicicleta em relação ao total</caption>
<thead>
<tr class="header">
<th align="left">2011</th>
<th align="left">2012</th>
<th align="left">2013</th>
<th align="left">2014</th>
<th align="left">2015</th>
<th align="left">2016</th>
<th align="left">2017</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">3.20%</td>
<td align="left">3.50%</td>
<td align="left">2.80%</td>
<td align="left">2.80%</td>
<td align="left">0.00%</td>
<td align="left">3.50%</td>
<td align="left">3.40%</td>
</tr>
</tbody>
</table>
</div>
<div id="colisoes-e-atropelamentos-sao-os-acidentes-mais-comuns" class="section level3">
<h3>Colisões e atropelamentos são os acidentes mais comuns</h3>
<pre class="r"><code>acidentes %&gt;% 
  count(ano = as.factor(ano), tipo_acidente) %&gt;%
  mutate(tipo_acidente = if_else(n &lt; 1000, &quot;Outros&quot;, tipo_acidente)) %&gt;%
  group_by(ano, tipo_acidente) %&gt;% 
  summarise(n = sum(n)) %&gt;% 
  group_by(ano) %&gt;% 
  mutate(prop = prop.table(n)) %&gt;% 
  ggplot(aes(x = ano, y = prop, colour = reorder(tipo_acidente, -prop))) +
  geom_point() +
  geom_line(aes(group = tipo_acidente)) +
  scale_colour_brewer(palette = &quot;Set2&quot;, &quot;Tipo de\nacidente&quot;) +
  scale_y_continuous(labels = scales::percent)</code></pre>
<p><img src="/post/2019-02-18-acidentalidade-de-ciclomobilidade-na-cidade-de-sao-paulo.pt-br_files/figure-html/unnamed-chunk-13-1.png" width="864" style="display: block; margin: auto;" /></p>
</div>
</div>
